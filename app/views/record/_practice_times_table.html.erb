<%# サークルを「X'XX"」形式で表示 %>
<% circle_min = log.circle.to_i / 60 %>
<% circle_sec = log.circle.to_i % 60 %>
<% circle_str = "#{circle_min}'#{format('%02d', circle_sec)}\"" %>

<div class="text-xl font-bold text-gray-900 mb-2">
  <%= I18n.l(log.attendance_event.date, format: '%Y/%m/%d(%a)') %>の記録　<%= "#{log.distance}m × #{log.rep_count}本 × #{log.set_count}セット 　#{log.style}　#{circle_str}" %>
</div>

<table class="min-w-full divide-y divide-gray-200">
  <tbody class="bg-white divide-y divide-gray-200">
    <% prev_set = nil %>
    <% practice_times.each do |time| %>
      <% if prev_set != time.set_number %>
        <tr>
          <td colspan="3" class="bg-gray-100 font-bold text-left px-6 py-2"><%= time.set_number %>セット目</td>
        </tr>
        <% prev_set = time.set_number %>
      <% end %>
      <tr>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= time.rep_number %>本目</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
          <% if time.time.to_f >= 60 %>
            <%= format("%d:%05.2f", time.time.to_f / 60, time.time.to_f % 60) %>
          <% else %>
            <%= format("%.2f", time.time.to_f) %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% times = practice_times.map { |t| t.time.to_f } %>
<% if times.present? %>
  <% avg = times.sum / times.size %>
  <% max = times.max %>
  <% min = times.min %>
  <div class="mt-4 text-left text-sm text-gray-700">
    平均値:
    <% if avg >= 60 %>
      <%= format("%d:%05.2f", avg / 60, avg % 60) %>
    <% else %>
      <%= format("%.2f", avg) %>
    <% end %>
    ／ 最遅値:
    <% if max >= 60 %>
      <%= format("%d:%05.2f", max / 60, max % 60) %>
    <% else %>
      <%= format("%.2f", max) %>
    <% end %>
    ／ 最速値:
    <% if min >= 60 %>
      <%= format("%d:%05.2f", min / 60, min % 60) %>
    <% else %>
      <%= format("%.2f", min) %>
    <% end %>
  </div>
<% end %> 