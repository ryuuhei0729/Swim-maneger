<% status_order = { 'present' => 0, '出席' => 0, 'late' => 1, '遅刻' => 1, 'absent' => 2, '欠席' => 2 } %>
<% sorted_attendance = attendance.sort_by { |a| [status_order[a.status] || 99, a.user.generation || 0] } %>

<h4 class="text-lg font-bold mb-4"><%= event.title %>（<%= event.date.strftime('%Y/%m/%d') %>）</h4>
<div class="overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200 text-sm">
    <thead>
      <tr>
        <th class="px-4 py-2 bg-gray-100 text-left font-semibold text-gray-700">名前</th>
        <th class="px-4 py-2 bg-gray-100 text-left font-semibold text-gray-700">出席状況</th>
        <th class="px-4 py-2 bg-gray-100 text-left font-semibold text-gray-700">備考</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% sorted_attendance.each_with_index do |attendance, i| %>
        <tr class="<%= i.even? ? 'bg-white' : 'bg-gray-50' %> hover:bg-blue-50 transition">
          <td class="px-4 py-2"><%= attendance.user.name %></td>
          <td class="px-4 py-2">
            <% case attendance.status %>
            <% when 'present', '出席' %>
              <span class="inline-block px-2 py-0.5 rounded bg-green-100 text-green-800 text-xs font-semibold">出席</span>
            <% when 'absent', '欠席' %>
              <span class="inline-block px-2 py-0.5 rounded bg-red-100 text-red-800 text-xs font-semibold">欠席</span>
            <% when 'late', '遅刻' %>
              <span class="inline-block px-2 py-0.5 rounded bg-yellow-100 text-yellow-800 text-xs font-semibold">遅刻</span>
            <% else %>
              <span class="inline-block px-2 py-0.5 rounded bg-gray-200 text-gray-600 text-xs font-semibold"><%= attendance.status %></span>
            <% end %>
          </td>
          <td class="px-4 py-2 text-gray-700"><%= attendance.note.presence || '—' %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>