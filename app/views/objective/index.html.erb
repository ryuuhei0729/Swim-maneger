<% content_for :title, 'Objective' %>

<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">目標一覧</h1>

  <% if @objective.none? { |obj| days_until(obj.attendance_event.date) >= 0 } %>
    <div class="bg-gray-100 rounded-lg p-6 text-center">
      <p class="text-gray-600">現在、設定されている目標はありません。</p>
    </div>
  <% else %>
    <div class="grid grid-cols-1 gap-6">
      <% @objective.each do |objective| %>
        <div class="bg-white shadow rounded-lg p-6">
          <div class="flex gap-8 mb-6">
            <div class="flex-none">
              <div class="text-2xl font-bold text-blue-900 mb-1">
                <%= objective.attendance_event.title %>
              </div>
              <div class="text-base text-gray-500">
                <%= objective.attendance_event.date.strftime('%Y年%m月%d日') %>
              </div>
            </div>
            <div class="flex items-center justify-between flex-grow">
              <div class="flex items-center">
                <span class="text-2xl font-bold text-gray-700"><%= objective.style.name_jp %></span>
                <span class="text-3xl font-bold text-blue-600 ml-4">&nbsp;<%= format_time(objective.target_time) %></span>
              </div>
              <% days = days_until(objective.attendance_event.date) %>
              <span class="text-lg font-bold <%= days.negative? ? 'text-gray-500' : (days.zero? ? 'text-green-600' : 'text-red-500') %>">
                あと <span class="text-3xl"><%= format_days_until(objective.attendance_event.date) %></span> 日！
              </span>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-gray-50 p-4 rounded">
              <h3 class="font-semibold mb-2">定量目標</h3>
              <p><%= objective.quantity_note %></p>
            </div>
            <div class="bg-gray-50 p-4 rounded">
              <h3 class="font-semibold mb-2">定性目標: <%= objective.quality_title %></h3>
              <p><%= objective.quality_note %></p>
            </div>
          </div>

          <% if objective.milestones.any? %>
            <div class="mt-4">
              <h3 class="font-semibold mb-2">マイルストーン</h3>
              <div class="space-y-3">
                <% objective.milestones.order(:limit_date).each do |milestone| %>
                  <div class="flex items-center bg-gray-50 p-3 rounded">
                    <div class="flex-1">
                      <div class="text-sm text-gray-500">
                        期限: <%= milestone.limit_date.strftime('%Y年%m月%d日') %>
                      </div>
                      <div><%= milestone.note %></div>
                    </div>
                    <% if milestone.milestone_review.present? %>
                      <div class="text-right">
                        <div class="font-semibold">
                          達成率: <%= milestone.milestone_review.achievement_rate %>%
                        </div>
                        <div class="text-sm text-green-600">
                          <%= milestone.milestone_review.positive_note %>
                        </div>
                        <div class="text-sm text-red-600">
                          <%= milestone.milestone_review.negative_note %>
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div> 